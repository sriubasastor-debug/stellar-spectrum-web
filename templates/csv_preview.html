<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CSV é¢„è§ˆ â€¢ äº¤äº’å¼è¡¨æ ¼</title>

<!-- DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css" />
<!-- AOS -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet" />
<!-- fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{margin:0;background:linear-gradient(180deg,#071028,#0b1326);color:#eaf2ff;font-family:Inter, "Microsoft Yahei"}
.container{max-width:1200px;margin:18px auto;padding:18px}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:16px;border-radius:12px}
.dt-container{margin-top:12px;overflow:auto;border-radius:8px;padding:8px;background:rgba(0,0,0,0.04)}
table.dataTable thead th{background:#12243f;color:#fff}
.button{background:linear-gradient(90deg,#6ea8ff,#7b61ff);padding:10px 14px;border-radius:10px;color:white;border:none;font-weight:600}
.small{font-size:13px;color:#9fb4d9}
.hrwrap{margin-top:16px;text-align:center}
.img-hr{max-width:100%;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
.controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
@media (max-width:900px){.header{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>
<div class="container" data-aos="fade-up">
  <div class="header">
    <div>
      <h1>ğŸ“Š æ˜Ÿè¡¨é¢„è§ˆ</h1>
      <div class="small">æºæ–‡ä»¶ï¼š<strong>{{ original_name }}</strong> Â· å…± <strong>{{ stats.total }}</strong> è¡Œ</div>
    </div>

    <div class="controls">
      <form method="post" action="/generate_pdf" style="display:inline">
        <input type="hidden" name="csv_b64" value="{{ csv_b64 }}">
        <input type="hidden" name="original_name" value="{{ original_name }}">
        <button class="button" type="submit">âœ… ç”Ÿæˆ PDF æŠ¥å‘Šå¹¶ä¸‹è½½</button>
      </form>
      <a href="/csv" class="button" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfe4ff;text-decoration:none">ğŸ”™ è¿”å›ä¸Šä¼ </a>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="dt-container">
      <table id="preview-table" class="display responsive nowrap" style="width:100%;color:#eaf2ff">
        <thead>
          <tr>
            <th>ç¼–å·</th>
            <th>å…‰è°±</th>
            <th>æ¸©åº¦ (K)</th>
            <th>å…‰åº¦ (Lâ˜‰)</th>
            <th>ç®€å•åˆ†ç±»</th>
            <th>ä¸“ä¸šåˆ†ç±»</th>
          </tr>
        </thead>
        <tbody>
          {% for row in preview_table %}
          <tr>
            <td>{{ row.index }}</td>
            <td>{{ row.spectral or 'â€”' }}</td>
            <td>{% if row.temperature is none %}â€”{% else %}{{ '%.1f'|format(row.temperature) }}{% endif %}</td>
            <td>{% if row.luminosity is none %}â€”{% else %}{{ '%.4g'|format(row.luminosity) }}{% endif %}</td>
            <td>{{ row.simple }}</td>
            <td>{{ row.professional }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="hrwrap" style="margin-top:18px">
      <h3>ç»¼åˆ Hâ€“R å›¾</h3>
      {% if hr_image %}
        <img class="img-hr" src="data:image/png;base64,{{ hr_image }}" alt="HR å›¾">
      {% else %}
        <div class="small" style="padding:18px;background:rgba(255,255,255,0.02);border-radius:8px;color:#cfe4ff">åç«¯æœªè¿”å› HR å›¾ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œè¯·ç¨åç”ŸæˆæŠ¥å‘Šæˆ–ç¡®è®¤åç«¯ plot_hr_multi æ˜¯å¦è¢«è°ƒç”¨ï¼‰</div>
      {% endif %}
    </div>
  </div>
</div>

<!-- JS libs -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

<script>
AOS.init({duration:600,once:true});

// DataTable init with Chinese UI
$(document).ready(function(){
  $('#preview-table').DataTable({
    responsive: true,
    pageLength: 25,
    order: [[0,"asc"]],
    language: {
      "search": "æœç´¢ï¼š",
      "lengthMenu": "æ¯é¡µæ˜¾ç¤º _MENU_ æ¡",
      "info": "æ˜¾ç¤º _START_ åˆ° _END_ / _TOTAL_ æ¡",
      "paginate": { "first": "é¦–é¡µ", "last": "å°¾é¡µ", "next": "ä¸‹ä¸€é¡µ", "previous": "ä¸Šä¸€é¡µ" },
      "zeroRecords": "æœªæ‰¾åˆ°åŒ¹é…è®°å½•"
    }
  });
});
</script>
</body>
</html>
